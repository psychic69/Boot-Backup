╔═══════════════════════════════════════════════════════════╗
║                                                           ║
║       UNRAID USB RECOVERY - USER INSTRUCTIONS            ║
║                                                           ║
╚═══════════════════════════════════════════════════════════╝

EMERGENCY RECOVERY PROCESS
──────────────────────────
Note:  This process will fail if you have the old UNRAID Usb in the machine, 
it must be disabled or removed. The assumption is the drive is out of service.

STEP 1: PREPARE
───────────────
☐ Plug in your backup USB (labeled "UNRAID_DR") - Created by dr_usb_backup.sh
☐ Remove any USB drives labeled "UNRAID"
☐ Insert this Ventoy USB
☐ Restart and boot from this USB

STEP 2: BOOT SYSTEMRESCUE
──────────────────────────
1. At the Ventoy menu, select:
   "Unraid Recovery - SystemRescue" or the Systemrescue.iso

2. Wait for SystemRescue to boot, select normal (~30-60 seconds)

3. You'll see a SystemRescue command prompt

STEP 3: MOUNT VENTOY PARTITION
───────────────────────────────
At the SystemRescue prompt, type:

1. The system will map the ventoy base partition into /dev/mapper
2. run mkdir /mnt/script
3. ls /dev/mapper and find the ventoy partition.  It should be the only sdx1 (like sdb1)
4. Mount the ventoy partition:  mount /dev/mapper/sdb1 /mnt/script
5. If you cannot find the /dev/mapper, run mountall and it should loopback mount it to /dev/sdb1

STEP 4: RUN THE RECOVERY SCRIPT
────────────────────────────────
Change to the directory with the script

   cd /mnt/script/unraid_recovery

Run the script (ensure UNRAID_DR USB plugged in also)

   ./move_dr_to_unraid.sh

STEP 5: FOLLOW THE PROMPTS
───────────────────────────
The script will:
✓ Verify your UNRAID_DR backup USB is plugged in
✓ Check for conflicts with existing UNRAID drives
✓ Change the label from UNRAID_DR to UNRAID
✓ Make the drive bootable, the script may ask to make bootable say "Y"
✓ Enable UEFI boot.  This script will not work with BIOS only, must have UEFI Bios
✓ Show you when it's complete

Note: You may see errors on hidden(2048) on syslinux/MBR.  
This is because I use modern partition scheme
which will reduces read/writes as it is not sector aligned w/ USB.
You should ignore.

STEP 6: FINISH
──────────────
When you see "✅ All done!":
1. Type: poweroff
2. Press Enter
3. Wait for shutdown
4. Remove this Ventoy USB
5. Restart w/ restored drive and profit.

Note: Since this is a new USB, you will need to relicense this new drive and the
old drive will be permanently blacklisted so if you are testing DO NOT relicense else
your original UNRAID USB will be permanently eliminated from running Unraid.

═══════════════════════════════════════════════════════════

TROUBLESHOOTING
───────────────

Problem: Can't find the script after mountall
→ Type: ls /mnt/
→ Look for mount points like sdb1, sdc1, etc.
→ Type: ls /mnt/sdb1/ (replace with actual mount point)
→ Look for "unraid_recovery" folder

Problem: "No USB drive with label UNRAID_DR found"
→ Make sure your backup USB is plugged in
→ Check the label is exactly "UNRAID_DR"

Problem: "A drive with label UNRAID already exists"
→ Remove the existing UNRAID USB first
→ This script only works when UNRAID drive is missing/dead

Problem: Permission denied
→ Make sure you're logged in as root
→ SystemRescue boots as root by default

═══════════════════════════════════════════════════════════

